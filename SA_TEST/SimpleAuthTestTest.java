package com.shinhan;

import com.shinhan.security.imple.SAProperty;
import com.shinhan.security.imple.SASimpleAuthAction;
import com.shinhan.security.simpleauth.SAConst;
import com.shinhan.security.simpleauth.exception.SASimpleAuthException;
import com.shinhan.security.simpleauth.message.SAMessageUtil;
import org.junit.jupiter.api.BeforeEach;
import org.junit.jupiter.api.Test;
import org.mockito.Mock;
import org.springframework.boot.test.context.SpringBootTest;
import org.springframework.mock.web.MockHttpSession;

import javax.servlet.http.HttpSession;

import static org.junit.jupiter.api.Assertions.*;

@SpringBootTest(classes = Runnable.class)
class SimpleAuthTestTest {

    public String APP_ID 		 = "TEST_ALIAS";
    public String APP_ALIAS 	 = "SA_ALIAS";
    public String APP_VERSION 	 = "1.0";
    public String AUTH_TYPE 	 = "2";

    public String CUSNO			 = "0987654321";
    public String ID 			 = "1234567890";
    public long   currentTime    = 1630642197023L;

    // 클라이언트 고정값
    public String strChallenge   = "3E74C931086CF7B52FA22921E4718134433A0CE65045740540E303CA46D492F86D0F55667D5EA1EADDB68D0544F0F2A4B99F62498C4148F5E0E744DF710C0297";
    public String PUBKEY 		 = "30820122300D06092A864886F70D01010105000382010F003082010A0282010100997A4DE16E426664DB117B7EEBAD0F17BF1C317EEE8A4D1D441C60CD26598B03B3BCA3277BDCB0FDC26D3541575D14510103D7A127829A2CF2D2FAC6F61E1AD4D4685945C3AFF3F70B4261CBA77D07A60CB52217A25A1E7F412EBA83D44B4D5F5EC84D7B6AB438814A767637E2FBAFB73EE6442D85AF15A38DE59324ECB65FE58C864AA5B367DAD43C739C8B6562AE013406CF1985DD065FF5BB0D9C23CF118902ED7CB418718BA8B839340583A6BF9058AE04FDFD22AA2E265B5A83EBCB0397EB328D4A4FCC7F29AAAE528C3D18AE71475D3E574E3B53ABCD2747098EE2291F235C578788B72715768F2A6371C495693F543F15DDB2F518161BB7801307D0FD0203010001";
    public String PRIKEY 		 = "308204BE020100300D06092A864886F70D0101010500048204A8308204A40201000282010100997A4DE16E426664DB117B7EEBAD0F17BF1C317EEE8A4D1D441C60CD26598B03B3BCA3277BDCB0FDC26D3541575D14510103D7A127829A2CF2D2FAC6F61E1AD4D4685945C3AFF3F70B4261CBA77D07A60CB52217A25A1E7F412EBA83D44B4D5F5EC84D7B6AB438814A767637E2FBAFB73EE6442D85AF15A38DE59324ECB65FE58C864AA5B367DAD43C739C8B6562AE013406CF1985DD065FF5BB0D9C23CF118902ED7CB418718BA8B839340583A6BF9058AE04FDFD22AA2E265B5A83EBCB0397EB328D4A4FCC7F29AAAE528C3D18AE71475D3E574E3B53ABCD2747098EE2291F235C578788B72715768F2A6371C495693F543F15DDB2F518161BB7801307D0FD0203010001028201000DE31D2CEAB72360B8D9CA1CDFE256DD45339DDEE862A73BA0B018AA37701EBE05036A97E603401896011FB27BDF363966281CD8BE247922DC0DEF1715A9FFAF8650B2D33733B29585F549B80DBDA87583ECD7DADF9BDBEA93D1509B21187735CBF3BFDF0CF6A5AE3D389ED5CBBA0E5A3C5CC58A80F028BB15D9D208A34A953EA21394EF849A67A96CD32A24973C70A0E7EB6A28ED26BA9BB520B07D8AFE5E918A95D887DEF945147E255CB3BA56B5708EA073F5C88807DB071ABF05CCAC385FB7A53D98EC3736C864EC78859832FC71A04111AB3E890CC8B8D06C380ECE7398D0B80259516453A7D038D6502FCBC1B754D724A966D711EB02A62C8B7103EE8102818100D506BA94982C7927426AD5172DC3B03A368474BA3369AEF46C269C88EC688F0AB1B0F09A103F4769B24F43B9F77BB863AAE43233798D601FED7E62826BF7CD602E2CC3E49E424C5E3BB5AA7FE07FE9333B597070298CE88B904445AC068F104D23E54839BD11110DDAEDAE7BB47DEE15CBC3FF6A68011CD88B3764DAAFA0BC3102818100B87052B7AD68F53D3B1C13E041979265D558D1DA632111B96D969DE0361BEE29FFC1E537AB126791DB70C420C39475A2CA3CB7AB7F19FA675EDCE07F65A9B91CE2B64CB6DC9E2FB40C3F2263E146FA66DB1DB5B6C8A126C1057E33822EDA8C4A15885E3F8F7C144BFEB8C5DADEB138127FCDA88CD4900D8454E0BB389E3A4A8D0281810091F73C5D992FD00C309C574ABC96FBE7C777572C4712414945D9E7248328D9EAAFFAD7C21923E2E0EFC7145716D6F56F85A73B26BE413AFE659356189BB67E494B1A6D57F780E22727AEC1174253230D71BB4529F5AE91A11FC7481E299859C921B1779DE8890B307D34A37C2C1EA5C6D58A8536F9F0D93D1F976349DD51BBE1028181008684EDDFA76B90CA3AED6C95B8614B565877B27EFCA3E6E07E4C47137B837D7E465A6DCADF4BCA1C389793846E013E971FB78F2256CE64B2B61E94E2760C86C5C998BA74F88DAB2F3F6B60B2C660D54AE56F52D4609A20C0D137CD6B9AAEAD796F2109D483DB349684CED107A43A4F3236E291973D855F466FFD84AF73C002150281807B8D8D2E59033CBE8BDEF90CF60AEE1C46D2559989910D32F76BCDA061F7484CA82F7251347093B2487A8C5A6DCF6B512023FECFD52390176E6F02D29836D0202B8A4D75516390BBEDD270082C83F4DFACAFBE0FBA8BE9AF6706E3B38BF8BCC4A08CF0D36C8198D99F26F4704791AB5407C63296F471FA4CF5C5959051B84FE3";
    public String UUID 			 = "uuid";
    HttpSession session;

    @BeforeEach
    void init()
    {
        SAProperty.setSA_Log(false);
        SAProperty.setSA_TBName("MBI_SIMPLEAUTH");
        SAProperty.setSA_ColumName("ID", "CUSNO", "PUBKEY", "UUID", "APP_ID", "TYPE", "STATUS", "REG_DTTM", "DROP_DTTM", "LAST_AUTH_DTTM");

        // log, sequence, index 생략
        SAProperty.setSA_DBPoolName("mbbPool");
        SAProperty.setSA_StatusValue("1", "9");

        session = new MockHttpSession();
        session.setAttribute(SAConst.TAG_CUSNO, CUSNO);
        session.setAttribute("sa_challenge", strChallenge);
        session.setAttribute("sa_authkey","2");


    }




    @Test
    void reg_init_test() throws SASimpleAuthException {
        String reqJson = "{\"tag\":\"3E01\",\"tmppub\":\"30820122300D06092A864886F70D01010105000382010F003082010A0282010100997A4DE16E426664DB117B7EEBAD0F17BF1C317EEE8A4D1D441C60CD26598B03B3BCA3277BDCB0FDC26D3541575D14510103D7A127829A2CF2D2FAC6F61E1AD4D4685945C3AFF3F70B4261CBA77D07A60CB52217A25A1E7F412EBA83D44B4D5F5EC84D7B6AB438814A767637E2FBAFB73EE6442D85AF15A38DE59324ECB65FE58C864AA5B367DAD43C739C8B6562AE013406CF1985DD065FF5BB0D9C23CF118902ED7CB418718BA8B839340583A6BF9058AE04FDFD22AA2E265B5A83EBCB0397EB328D4A4FCC7F29AAAE528C3D18AE71475D3E574E3B53ABCD2747098EE2291F235C578788B72715768F2A6371C495693F543F15DDB2F518161BB7801307D0FD0203010001\",\"appid\":\"TEST_ALIAS\"}";
        System.out.println("reqJson = " + reqJson);

//        HttpSession session = new MockHttpSession();
//        session.setAttribute(SAConst.TAG_CUSNO, CUSNO);
        String serverResult = new SimpleAuthTest().registInit("3E01", reqJson, session);
    }

    @Test
    void reg_test()
    {

        String result = "{\"tag\":\"3E02\",\"signdata\":\"37F2891ABAB2A9731C67A8C28E09DA71978063C237344AD7A92DE6994523029F1FA39A49EF1C7C5E94F3A0265C38E847A0DF0CFD21964DCEFED2A4760CA580E073234D1B478A955B24177610BDD2DE780CF4B46EB708A8C3183046DDB375A3F1C04025A5FE776A67BB92A3A6BE8A730A0527F0937F7CEBBC0233018B669BDA5C26D76BB233024A88B98FF4CC3ADD6A49AF5CCAD10A145DE211B0954A85A50F99239DEEBFB5A1F07D2656CD04D52738B41393BBC8D904175B6E7395B7297F691185A6048AEB08419DF9FB92F222BF49534FA86B7D54B6FE66A1179ADA0B6C2F68D759D9D33A1852C10098F569F25A0303B3497C0EB82A02529F65F2BD7C0D0731\",\"rd\":\"96E63A93A52CB506B6A5E213B2A7ECE45CE5CC670DF3CFC1444CA92342C1EFCD29082C1075855B17E8A8E3FE6F17CC9ADE241D43B297F8ED1768588D7B28175E5AFFF01E813B953936D3438ED8614889D63331FC63C70EA9DECC7B88517F6C6D627B7F419E641881315C963E6E34B2316D6C08E5C6747D5B6419A05C100809E0BA97246D93C6313F50C1EEA6B6D578E1319F192E0456F9DAA359C71D672730581A111D57F3E7EDC27AA6746F9B81F749F3C8DB3294A899D2DCE4C4B419C2E9973ADCD548408A85BBDB80372FB1A8BD1052A9CD18C88D927A700DEE4DF0D0FF64DD0D9BA26894D8F7EA1FDBA2CE4A46CCC2ABFD0142B2771F9CF2A0226E84EC7214CD95FF29E0DDE34C4410360A1E889E0429BD4DC2C3BA24CBDF6F83165754CBB68531B71971A8FC61116A9E06205EED52A57932AA3DC4CE687403F8D93C44D9A00759BDD621B58EB24341FC271F680012D26E783FE32F05E6F35A34380BB825B6E5BBF46A00F393BCE3173C437DD939DACCE56A70CC7F220EF40F7FEDD657B021BB83594B9B2CE62B2B8FF641E581545E06C1CB0F606562D96407E015BF58140366A5B111DC28F8912E4B311C845050132A23B3FFB45A54B126FFC6D5D178D65E64350D8B19DA40A87DAD06F7887CE1CB07EC2D64715D1BC2C126D6CF23757B727B2D8DB5181E941DFE9372A8838E560D9B885C9CB2B953EAFC524436662AA4F34FB7CF790367346C97271651D3EEE64D72A4AC895C700716DB62132ED86A62DF0554AB64201120A893F8AD7902812A0697E8430F116F51EE46F3CA82AFF4128454D096FF90F75ABEEA306BC6892296E5E0EF55BFA4FE0CD522F8D03A349644A9A804C457793A08A979482BBCFFCCFF75B89CDB35F0C27E48810C40BD3C7B386CB397360A4A32F9F4EEED97C9EFDCAA551571F1CC86A44DF2E1E27012AA9ACB96F5B69E2AADF07A8CA3543AACDDC829EC3637591697947EFE7867CDB3BC456C9454340BC292D0B57C2F236E9C77AA98276B61AAB2725FA37E11FF59F3C2338888436306D3CD4E65B74AB131E54407FF7DAA3A6A59A8204C9AC7D809478010B7199CF24AE1CA8F98E845AC1D106642D5AF4AD79AF1A80AE9B901EB9702E6297EF668F8EE5E575AB68073C8813B3F926741B1DE37003DDABCA2AA174FA5E36F0DAA4BC7441C7D1C02BB3D09CE0C8FDF08F9F25EE2D18FA6755F8852B66E2D3718ED49445E34CDE049281F1567AD5DD1A2214F4AD57E44DB95954C9AAD59A895B6\"}";
        System.out.println("result = " + result);
//        HttpSession session = new MockHttpSession();
//        session.setAttribute(SAConst.TAG_CUSNO, CUSNO);
//        session.setAttribute("sa_challenge", strChallenge);
        String serverResult = new SimpleAuthTest().regist("3E01", result, session);
        System.out.println("serverResult = " + serverResult);
    }


    @Test
    void auth_init_test()
    {

        // ID값 reg에서 나온값으로 변경해줘야함!
        String client = "{\"appversion\":\"1.0\",\"model\":\"Samsung_SM-N976N\",\"ostype\":\"A\",\"osversion\":\"11\",\"saversion\":\"1.0.4\",\"type\":\"2\",\"appid\":\"TEST_ALIAS\",\"id\":\"EE24B0E2D1D3C0E1322EC735C6E371E57E572897294ECDCBE5F196F20AD5364A\",\"tag\":\"3E11\",\"uuid\":\"6D8809FDD43FBDCAE4104D24C9D14FD320AFFAFEF20056D2EDCF69F4D6DF0BF52FED3A6DDAE96ECF8BB2ADA3005BA2072D94DC0478990974B7E0356FE7E3E8C1383A702204A995255CCB74C2593E8C390484B1A4FA24EA69E7EDC147A4773B2A74292485AE5C9627E840E0B96B9837F0D67B0C8B1E0F9B25C8C357604A38599C870AD6AAE7808790A94A0DAC1E4290B71D5D3EC4335AA1A1C101B7E8AB2CE018AC99403D7C65F22D4A1879859069EA0F6B8FB0390B13C1680A7D1C620556B0B49C6F1081A8831145B9FFE5977674D5E681A850850845646551295394E3B75440E6D3CB5F04567FE5D81A194F397526953102EB4DE0A8DE902FA494F0742891ED\"}";

        String serverResult = new SimpleAuthTest().authorizeInit("3E11", client, session);
        System.out.println("serverResult = " + serverResult);

        String server_result = "{\"erroryn\":\"n\",\"appid\":\"TEST_ALIAS\",\"cusno\":\"0987654321\",\"tag\":\"3E02\",\"id\":\"EE24B0E2D1D3C0E1322EC735C6E371E57E572897294ECDCBE5F196F20AD5364A\",\"type\":\"2\",\"uuid\":\"uuid\",\"status\":\"1\"}";
    }

    @Test
    void auth_test()
    {
       // String serverResult = "{\"erroryn\":\"n\",\"challenge\":\"3B2A2FBAE336D1ABC96AFBD2FFB03E3A5975F79910BE1BAD8341FEC830CB3BA0749289D019EAD918D22AAA9087B0A2BE0ABEFAEFC8478CA63ED7E2BEA78A3B07EC48A776F1461332E0522BB1CFA1F17B406850742F8B6A1E46C3AE6BCEB2A3A10C1426C8A14F8D4E44E45A17F1A24D72BCA68720E20FF38FB3DCA024E5E987A61D1777F9E29E9F16C2C9D118677407FF8570F77753E060800ED96E58F9D3FE4C2EA782FE801932C38EABF5469F4CB70FEA94D775C609668C927781A6ACA60E097344DFC07801347F23066D7411D9525276ACE2FE8173D74A47A5F91BF1865D240C2F046809560E88E2B097070AD3F317B61A0CE9D025DB8F865EF152CE19AB7F\",\"tag\":\"3E11\",\"time\":\"25F64F5A767037B388BD6EF9A2474E32DD1835B3066FDB8998A15D4EE60DDAF132A2C63652CCD209EA137E82752E51B67BFEADFB7730FE1B379F9A9D71BDB298EA4E8AB2782DD906C1E00E09DDE334250CA20B5029D89DBEC5A13AED51C5FFD53ED79D2DB940B4C01E39FCB0CD11F0048F96F9B8C1A9C2F3508A3C183B3FEA6404C5C8FFCA3037C95E725725EC89A1F5116F06942942E3D1F6C3F55C6CD23857F2C982543FB7AD69EFE99BCDCD1D96B0D938D39FFDD233284342571A0DFEB6D0D223C91330D1D8C8043DA7EBFA85EC2DA31E07514BEFE51E4C7D6ED79D55355C47821230C18822B07F97211CB9F1AE2B9CC9E9CEB2A76AAE073FCA7974E1744C\"}\n";
        String client = "{\"tag\":\"3E12\",\"signdata\":\"6A329A3C9E6605DC8F32AE8C02A4B3018FE8C65624581E97600C9C1595C97474B17F3E696A665FCFD083A66C55EEC040B13486E94DC9C05E9D15E6E71646B8FBCA95647B9609A99CBCF0CAB9333186D63EF0633F06509BE42596FC8840F2A42454922D4AD069AD4ECBE51395C85E235A5DCFE672827F5FF437A3057B6AE356354CEAD578D26A2C1B957505F5B4D02DC18CFCF2B18EAB14093F2C00C56365B8A497525C6D4A283C6D11E340A2FEAD2C2DB0894BF7D1D42CA183D3B02236767C0CDD6650E3A7A22E830D6BC5F81C29B6FA46F33860B5ABBE26B760BD2120BC515418E8E441CBC21C0F47F7D41E976F311F19EDB57185DD7A4F22D84B3BAE2BC8FB\",\"ad\":\"96E63A93A52CB506B6A5E213B2A7ECE45CE5CC670DF3CFC1444CA92342C1EFCD29082C1075855B17E8A8E3FE6F17CC9ADE241D43B297F8ED1768588D7B28175E5AFFF01E813B953936D3438ED8614889D63331FC63C70EA9DECC7B88517F6C6D627B7F419E641881315C963E6E34B2316D6C08E5C6747D5B6419A05C100809E0BA97246D93C6313F50C1EEA6B6D578E1319F192E0456F9DAA359C71D672730581A111D57F3E7EDC27AA6746F9B81F749F3C8DB3294A899D2DCE4C4B419C2E9973ADCD548408A85BBDB80372FB1A8BD1052A9CD18C88D927A700DEE4DF0D0FF64DD0D9BA26894D8F7EA1FDBA2CE4A46CCC2ABFD0142B2771F9CF2A0226E84EC7214CD95FF29E0DDE34C4410360A1E889E718FCBD712B06178AAA7CE70C87DB958\"}";
        String serverAuthResult = new SimpleAuthTest().authorize("3E12", client, session);
        System.out.println("serverAuthResult = " + serverAuthResult);

    }

    @Test
    void unreg_test()
    {
        String client = "{\"tag\":\"3E12\",\"id\":\"EE24B0E2D1D3C0E1322EC735C6E371E57E572897294ECDCBE5F196F20AD5364A\",\"appid\":\"TEST_ALIAS\",\"type\":\"2\"}";
        String unregist = new SimpleAuthTest().unregist("3E21", client, session);
        System.out.println("unregist = " + unregist);
    }


}
